<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{{ url_for('static', filename='myprof.css') }}" />
    <title>Perfil de Usuario</title>
  </head>
  <body>
    <!-- Perfil de usuario -->
    <section class="form-register">
      <h4>Perfil de Usuario</h4>

      {% if 'user_id' in session %}
        <!-- Mostrar información del usuario logueado -->
        <p class="imgpfp">
            <strong>Foto de perfil</strong>
            <img class="pfp" src="{{ user.image_url }}" alt="Imagen de usuario" />
          </p>
          <p><strong>Nombre de usuario:</strong> {{ user.user_name }}</p>
          <p><strong>Email:</strong> {{ user.email }}</p>

        <!-- Opción para eliminar cuenta -->
        <form id="deleteForm" method="POST" action="{{ url_for('user_bp.delete_user', user_id=user.id) }}">
            <input type="hidden" name="_method" value="DELETE">  <!-- Simulamos DELETE -->
            <button type="submit">Eliminar cuenta</button>
        </form>

        <!-- Opción para cerrar sesión -->
        <a href="{{ url_for('user_bp.logout') }}" class="buttons">Cerrar sesión</a>
      {% else %}
        <p>No estás logueado. <a href="{{ url_for('user_bp.login') }}">Iniciar sesión</a></p>
      {% endif %}
    </section>

    <!-- Contenedor principal para publicaciones -->
    <div class="main-content">
      <h3>Posts de {{ user.user_name }}</h3>
      <div class="posts-container">
        {% for post in posts %}
          <div class="post">
            <h4>{{ post.title }}</h4>
            <p>{{ post.content }}</p>
            {% if post.image_url %}
              <img src="{{ post.image_url }}" alt="Imagen del post">
            {% endif %}
            <hr>
          </div>
        {% else %}
          <p>No has hecho ningún post aún.</p>
        {% endfor %}
      </div>

      <!-- Formulario para agregar un nuevo post -->
      <form id="profileForm" method="POST" action="{{ url_for('user_bp.profile') }}" enctype="multipart/form-data">
        <label for="title">Título:</label>
        <input type="text" id="title" name="title" required>

        <label for="content">Contenido:</label>
        <textarea id="content" name="content" required></textarea>

        <label for="profileImage">Agregar una foto:</label>
        <input type="file" id="profileImage" name="profileImage" accept="image/*">
        <button type="submit">Publicar</button>
      </form>
    </div>

    <script>
      document.getElementById('deleteForm').addEventListener('submit', function(event) {
        event.preventDefault();  // Evita que el formulario se envíe de inmediato
        if (confirm('¿Estás seguro de que deseas eliminar tu cuenta?')) {
          this.submit();  // Si el usuario confirma, envía el formulario
        }
      });
    </script>
  </body>
</html>
